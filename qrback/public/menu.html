<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Digital Menu</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        line-height: 1.6;
        color: #333;
        background: #f8f9fa;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }

      .restaurant-header {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        text-align: center;
        position: relative;
      }

      .translate-button {
        position: absolute;
        top: 20px;
        right: 20px;
        background: #3498db;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9em;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: background 0.3s ease;
      }

      .translate-button:hover {
        background: #2980b9;
      }

      .translate-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        min-width: 200px;
        max-height: 300px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
      }

      .language-option {
        padding: 10px 15px;
        cursor: pointer;
        border-bottom: 1px solid #f0f0f0;
        transition: background 0.2s ease;
      }

      .language-option:hover {
        background: #f8f9fa;
      }

      .language-option:last-child {
        border-bottom: none;
      }

      .restaurant-name {
        font-size: 2.5em;
        color: #2c3e50;
        margin-bottom: 10px;
        font-weight: 700;
      }

      .restaurant-info {
        color: #666;
        font-size: 1.1em;
      }

      .table-info {
        background: #e74c3c;
        color: white;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        margin-bottom: 30px;
        font-weight: 600;
      }

      .category {
        margin-bottom: 40px;
      }

      .category-title {
        font-size: 1.8em;
        color: #2c3e50;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid #e74c3c;
        font-weight: 600;
      }

      .menu-items {
        display: grid;
        gap: 25px;
      }

      .menu-item {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .menu-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .menu-item-image-container {
        width: 100%;
        height: 250px;
        overflow: hidden;
        position: relative;
        background: #f0f0f0;
      }

      .menu-item-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
      }

      .menu-item:hover .menu-item-image {
        transform: scale(1.05);
      }

      .no-image-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        color: #6c757d;
        font-size: 3em;
      }

      .menu-item-content {
        padding: 25px;
      }

      .menu-item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        gap: 15px;
      }

      .menu-item-name {
        font-size: 1.4em;
        font-weight: 700;
        color: #2c3e50;
        margin: 0;
        line-height: 1.3;
      }

      .menu-item-price {
        font-size: 1.3em;
        font-weight: 800;
        color: #e74c3c;
        white-space: nowrap;
        background: #fff5f5;
        padding: 8px 12px;
        border-radius: 8px;
        border: 2px solid #ffe6e6;
      }

      .menu-item-description {
        color: #555;
        font-size: 1em;
        line-height: 1.6;
        margin-bottom: 10px;
        margin-top: 0;
      }

      .menu-item-description.truncated {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .menu-item-description.expanded {
        display: block;
      }

      .show-more-btn {
        background: none;
        border: none;
        color: #3498db;
        cursor: pointer;
        font-weight: 600;
        padding: 5px 0;
        font-size: 0.9em;
        transition: color 0.3s ease;
      }

      .show-more-btn:hover {
        color: #2980b9;
        text-decoration: underline;
      }

      .loading {
        text-align: center;
        padding: 60px 20px;
      }

      .loading-spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #e74c3c;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .error-message {
        background: #ff4757;
        color: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        margin: 20px 0;
      }

      .no-menu {
        background: white;
        padding: 40px;
        border-radius: 12px;
        text-align: center;
        color: #666;
      }

      /* Mobile Responsive */
      @media (max-width: 600px) {
        .container {
          padding: 15px;
        }

        .restaurant-header {
          padding: 25px 20px 25px 20px;
        }

        .translate-button {
          top: 15px;
          right: 15px;
          padding: 8px 12px;
          font-size: 0.85em;
        }

        .restaurant-name {
          font-size: 2em;
          margin-right: 80px; /* Account for translate button */
        }

        .menu-item-image-container {
          height: 200px;
        }

        .menu-item-content {
          padding: 20px;
        }

        .menu-item-name {
          font-size: 1.3em;
        }

        .menu-item-price {
          font-size: 1.2em;
          padding: 6px 10px;
        }

        .menu-item-header {
          flex-direction: row;
          gap: 10px;
          align-items: center;
        }
      }

      /* Very small screens */
      @media (max-width: 400px) {
        .menu-item-image-container {
          height: 180px;
        }

        .restaurant-name {
          font-size: 1.7em;
        }
      }

      /* Translation loading state */
      .translating {
        opacity: 0.7;
        position: relative;
      }

      .translating::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.8);
        border-radius: inherit;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="loading" class="loading">
        <div class="loading-spinner"></div>
        <p>Loading menu...</p>
      </div>

      <div id="error-container" style="display: none">
        <div class="error-message">
          <h3>Oops! Something went wrong</h3>
          <p id="error-message"></p>
        </div>
      </div>

      <div id="menu-container" style="display: none">
        <div class="restaurant-header">
          <button class="translate-button" id="translate-btn">
            üåê Translate
          </button>
          <div class="translate-dropdown" id="translate-dropdown">
            <div class="language-option" data-lang="en">üá∫üá∏ English</div>
            <div class="language-option" data-lang="es">üá™üá∏ Spanish</div>
            <div class="language-option" data-lang="fr">üá´üá∑ French</div>
            <div class="language-option" data-lang="de">üá©üá™ German</div>
            <div class="language-option" data-lang="it">üáÆüáπ Italian</div>
            <div class="language-option" data-lang="pt">üáµüáπ Portuguese</div>
            <div class="language-option" data-lang="ru">üá∑üá∫ Russian</div>
            <div class="language-option" data-lang="ja">üáØüáµ Japanese</div>
            <div class="language-option" data-lang="ko">üá∞üá∑ Korean</div>
            <div class="language-option" data-lang="zh">üá®üá≥ Chinese</div>
            <div class="language-option" data-lang="hi">üáÆüá≥ Hindi</div>
            <div class="language-option" data-lang="ar">üá∏üá¶ Arabic</div>
          </div>

          <h1 class="restaurant-name" id="restaurant-name"></h1>
          <div class="restaurant-info">
            <p id="restaurant-address"></p>
          </div>
        </div>

        <div class="table-info">
          <p>
            You are viewing the menu for Table <span id="table-number"></span>
          </p>
        </div>

        <div id="menu-content"></div>

        <div id="no-menu" class="no-menu" style="display: none">
          <h3>Menu Coming Soon</h3>
          <p>
            This restaurant hasn't added any menu items yet. Please check back
            later!
          </p>
        </div>
      </div>
    </div>

    <script>
      // Get restaurant ID and table number from URL path
      const pathParts = window.location.pathname.split("/");
      const restaurantId = pathParts[2];
      const tableNumber = pathParts[3];
      let currentLanguage = "en";
      let originalTexts = {}; // Store original texts for translation

      // Translation functionality
      const translateButton = document.getElementById("translate-btn");
      const translateDropdown = document.getElementById("translate-dropdown");

      translateButton.addEventListener("click", (e) => {
        e.stopPropagation();
        translateDropdown.style.display =
          translateDropdown.style.display === "block" ? "none" : "block";
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", () => {
        translateDropdown.style.display = "none";
      });

      // Language selection
      document.querySelectorAll(".language-option").forEach((option) => {
        option.addEventListener("click", (e) => {
          const targetLang = e.target.getAttribute("data-lang");
          translatePage(targetLang);
          translateDropdown.style.display = "none";
        });
      });

      async function translatePage(targetLang) {
        if (targetLang === currentLanguage) return;

        try {
          // Show loading state
          document.body.classList.add("translating");
          translateButton.textContent = "üîÑ Translating...";

          const elementsToTranslate = [
            ...document.querySelectorAll(".restaurant-name"),
            ...document.querySelectorAll(".restaurant-info p"),
            ...document.querySelectorAll(".table-info p"),
            ...document.querySelectorAll(".category-title"),
            ...document.querySelectorAll(".menu-item-name"),
            ...document.querySelectorAll(".menu-item-description"),
            ...document.querySelectorAll(".no-menu h3"),
            ...document.querySelectorAll(".no-menu p"),
          ];

          // Store original texts if translating for the first time
          if (currentLanguage === "en") {
            elementsToTranslate.forEach((element, index) => {
              originalTexts[index] = element.textContent;
            });
          }

          if (targetLang === "en") {
            // Restore original texts
            elementsToTranslate.forEach((element, index) => {
              if (originalTexts[index]) {
                element.textContent = originalTexts[index];
              }
            });
          } else {
            // Translate texts
            const textsToTranslate = elementsToTranslate.map(
              (el, index) => originalTexts[index] || el.textContent
            );

            const translatedTexts = await translateTexts(
              textsToTranslate,
              targetLang
            );

            elementsToTranslate.forEach((element, index) => {
              if (translatedTexts[index]) {
                element.textContent = translatedTexts[index];
              }
            });
          }

          currentLanguage = targetLang;
          translateButton.textContent = "üåê Translate";
        } catch (error) {
          console.error("Translation error:", error);
          translateButton.textContent = "‚ùå Translation Error";
          setTimeout(() => {
            translateButton.textContent = "üåê Translate";
          }, 2000);
        } finally {
          document.body.classList.remove("translating");
        }
      }

      async function translateTexts(texts, targetLang) {
        // Using LibreTranslate API (free alternative to Google Translate)
        // You can replace this with Google Translate API if you have an API key
        try {
          const translatedTexts = [];

          for (const text of texts) {
            if (!text.trim()) {
              translatedTexts.push(text);
              continue;
            }

            // Use MyMemory API which is more reliable and doesn't require CORS setup
            const encodedText = encodeURIComponent(text);
            const response = await fetch(
              `https://api.mymemory.translated.net/get?q=${encodedText}&langpair=en|${targetLang}`
            );

            if (response.ok) {
              const result = await response.json();
              if (result.responseStatus === 200) {
                translatedTexts.push(result.responseData.translatedText);
              } else {
                translatedTexts.push(text);
              }
            } else {
              // Fallback: return original text if translation fails
              translatedTexts.push(text);
            }

            // Small delay to avoid rate limiting
            await new Promise((resolve) => setTimeout(resolve, 300));
          }

          return translatedTexts;
        } catch (error) {
          console.error("Translation service error:", error);
          // Return original texts as fallback
          return texts;
        }
      }

      async function loadMenu() {
        try {
          const response = await fetch(
            `/api/menus/${restaurantId}/${tableNumber}`
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          // Hide loading
          document.getElementById("loading").style.display = "none";

          // Show menu container
          document.getElementById("menu-container").style.display = "block";

          // Populate restaurant info
          document.getElementById("restaurant-name").textContent =
            data.restaurant.name;
          document.getElementById("restaurant-address").textContent =
            data.restaurant.address || "";
          document.getElementById("table-number").textContent =
            data.table_number;

          // Check if menu has items
          const menuCategories = Object.keys(data.menu);
          if (menuCategories.length === 0) {
            document.getElementById("no-menu").style.display = "block";
            return;
          }

          // Populate menu
          const menuContent = document.getElementById("menu-content");
          menuContent.innerHTML = "";

          menuCategories.forEach((category) => {
            const items = data.menu[category];
            if (items.length === 0) return;

            const categoryDiv = document.createElement("div");
            categoryDiv.className = "category";

            const categoryTitle = document.createElement("h2");
            categoryTitle.className = "category-title";
            categoryTitle.textContent = category;
            categoryDiv.appendChild(categoryTitle);

            const itemsDiv = document.createElement("div");
            itemsDiv.className = "menu-items";

            items.forEach((item, index) => {
              const itemDiv = document.createElement("div");
              itemDiv.className = "menu-item";

              // Image container (always present, even if no image)
              const imageContainer = document.createElement("div");
              imageContainer.className = "menu-item-image-container";

              if (item.image_url) {
                const img = document.createElement("img");
                img.src = item.image_url;
                img.alt = item.name;
                img.className = "menu-item-image";
                imageContainer.appendChild(img);
              } else {
                const placeholder = document.createElement("div");
                placeholder.className = "no-image-placeholder";
                placeholder.textContent = "üçΩÔ∏è";
                imageContainer.appendChild(placeholder);
              }

              itemDiv.appendChild(imageContainer);

              // Content container
              const contentDiv = document.createElement("div");
              contentDiv.className = "menu-item-content";

              const headerDiv = document.createElement("div");
              headerDiv.className = "menu-item-header";

              const nameElement = document.createElement("h3");
              nameElement.className = "menu-item-name";
              nameElement.textContent = item.name;

              const priceElement = document.createElement("span");
              priceElement.className = "menu-item-price";
              priceElement.textContent = `$${parseFloat(item.price).toFixed(
                2
              )}`;

              headerDiv.appendChild(nameElement);
              headerDiv.appendChild(priceElement);
              contentDiv.appendChild(headerDiv);

              if (item.description) {
                const descElement = document.createElement("p");
                descElement.className = "menu-item-description";

                // Check if description is long (more than 100 characters)
                const isLong = item.description.length > 100;

                if (isLong) {
                  descElement.classList.add("truncated");
                  descElement.textContent = item.description;

                  const showMoreBtn = document.createElement("button");
                  showMoreBtn.className = "show-more-btn";
                  showMoreBtn.textContent = "Show more";

                  showMoreBtn.addEventListener("click", () => {
                    if (descElement.classList.contains("truncated")) {
                      descElement.classList.remove("truncated");
                      descElement.classList.add("expanded");
                      showMoreBtn.textContent = "Show less";
                    } else {
                      descElement.classList.remove("expanded");
                      descElement.classList.add("truncated");
                      showMoreBtn.textContent = "Show more";
                    }
                  });

                  contentDiv.appendChild(descElement);
                  contentDiv.appendChild(showMoreBtn);
                } else {
                  descElement.textContent = item.description;
                  contentDiv.appendChild(descElement);
                }
              }

              itemDiv.appendChild(contentDiv);
              itemsDiv.appendChild(itemDiv);
            });

            categoryDiv.appendChild(itemsDiv);
            menuContent.appendChild(categoryDiv);
          });
        } catch (error) {
          console.error("Error loading menu:", error);
          document.getElementById("loading").style.display = "none";
          document.getElementById("error-container").style.display = "block";
          document.getElementById("error-message").textContent =
            "Failed to load the menu. Please try again later.";
        }
      }

      // Load menu when page loads
      window.addEventListener("load", loadMenu);
    </script>
  </body>
</html>
